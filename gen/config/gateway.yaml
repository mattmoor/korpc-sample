apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: grpc-gateway
  namespace: default
spec:
  gateways:
  - knative-ingress-gateway.knative-serving.svc.cluster.local
  - mesh
  hosts:
  - api.mattmoor.io
  http:

  - match:
    - uri:
        exact: /mattmoor.One/Magic
    rewrite:
      authority: magic-one.default.svc.cluster.local
    route:
      - destination:
          host: istio-ingressgateway.istio-system.svc.cluster.local
          port:
            number: 80
        weight: 100

  - match:
    - uri:
        exact: /mattmoor.Two/Blur
    rewrite:
      authority: blur-two.default.svc.cluster.local
    route:
      - destination:
          host: istio-ingressgateway.istio-system.svc.cluster.local
          port:
            number: 80
        weight: 100

  - match:
    - uri:
        exact: /mattmoor.Two/Blah
    rewrite:
      authority: blah-two.default.svc.cluster.local
    route:
      - destination:
          host: istio-ingressgateway.istio-system.svc.cluster.local
          port:
            number: 80
        weight: 100

  - match:
    - uri:
        exact: /mattmoor.Three/Foo
    rewrite:
      authority: foo-three.default.svc.cluster.local
    route:
      - destination:
          host: istio-ingressgateway.istio-system.svc.cluster.local
          port:
            number: 80
        weight: 100

  - match:
    - uri:
        exact: /mattmoor.Three/Bar
    rewrite:
      authority: bar-three.default.svc.cluster.local
    route:
      - destination:
          host: istio-ingressgateway.istio-system.svc.cluster.local
          port:
            number: 80
        weight: 100

  - match:
    - uri:
        exact: /mattmoor.Three/Baz
    rewrite:
      authority: baz-three.default.svc.cluster.local
    route:
      - destination:
          host: istio-ingressgateway.istio-system.svc.cluster.local
          port:
            number: 80
        weight: 100

